<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>joinpage</title>
    <link rel="stylesheet" href="../static/css/join.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<input type="hidden" id="csrfToken" th:value="${_csrf.token}" />
<form name="joinForm" th:action="@{/member/join}" th:object="${joinForm}" method="post" onsubmit="return checkConfirm()">

    <div th:replace="~{form_errors :: formErrorsFragment}"></div>
    <div class="about-info">

        <h2>MBTI 회원가입</h2>
        <!-- <p>"MBTI 계정으로" <strong> 다양한 활동을 이용하실 수 있습니다.</strong></p> -->
        <!-- <h2 class="sch">학교선택</h2> -->


        <div class="input">
            <div class="label"><label>MBTI</label></div>
            <select name="memberMbti" class="mbti_select">
                <option value="">MBTI를 선택하세요</option>
                <option value="INTJ">INTJ</option>
                <option value="INTP">INTP</option>
                <option value="ENTJ">ENTJ</option>
                <option value="ENTP">ENTP</option>
                <option value="INFJ">INFJ</option>
                <option value="INFP">INFP</option>
                <option value="ENFJ">ENFJ</option>
                <option value="ENFP">ENFP</option>
                <option value='ISTJ'>ISTJ</option>
                <option value='ISFJ'>ISFJ</option>
                <option value='ESTJ'>ESTJ </option>
                <option value='ESFj'>ESFj </option>
                <option value='ISTP'>ISTP </option>
                <option value='ISFP'>ISFP </option>
                <option value='ESTP'>ESTP </option>
                <option value='ESFP'>ESFP </option>
            </select>
            <div/>
        
        <div class="input">
            <div class="label"><label>닉네임</label></div>
            <input type="text" name="memberNickname" class="campus_name search" maxlength="20" placeholder="닉네임을 입력하세요" autocomplete="off" >
            <input type="hidden" name="camppus_id">
<!--            <p>rm </p>-->
        </div>



        <form method="post" action="/mail">
            <div class="input">
                <div class="label"><label>이메일</label></div>
                <input id="mail" type="text" name="memberEmail" class="campus_name search" maxlength="60" placeholder="이메일을 입력하세요" autocomplete="off">
                <input type="hidden" name="camppus_id">
    <!--            <p>사용자의 이메일을 공개하지 않습니다.</p>-->
                <div class="input">
                    <button type="button" id="sendVerificationCode" onclick="sendNumber()">인증번호 발송</button>
                </div>
                <input type="text" id="Confirm" name="vari" style="display: none" value="">
                <div class="input" id = "check_number">
                    <div class="label"><label>인증번호</label></div>
                    <input type="text" name="Authentication " id = "number" class="" maxlength="" placeholder="">

                    <button type= "button" onclick="confirmNumber()" class="codecheck">인증번호 확인</button>
                </div>
            </div>
        </form>

            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
            <script type="text/javascript">
                var checked = false;
                function sendNumber(){
                    var email = $("#mail").val();

                    // 이메일 형식 검사
                    var emailFormat = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                    if (!emailFormat.test(email)) {
                        alert("유효하지 않은 이메일 형식입니다.");
                        return false;
                    }

                    // 이메일 중복 확인
                    $.ajax({
                        url: "/checkEmail",
                        type: "post",
                        data: {"email": email},
                        beforeSend:function(xhr){
                            xhr.setRequestHeader("X-CSRF-TOKEN", $("#csrfToken").val());
                        },
                        success: function(data) {
                            if (data == "duplicated") {
                                alert("이미 사용중인 이메일입니다.");
                                return false;
                            } else {
                                // 인증번호 발송 로직
                                $.ajax({
                                    url:"/sendMail",
                                    type:"post",
                                    dataType:"json",
                                    data:{"email" : email},
                                    beforeSend:function(xhr){
                                        xhr.setRequestHeader("X-CSRF-TOKEN", $("#csrfToken").val());
                                    },
                                    success: function(data){
                                        alert("인증번호 발송");
                                        $("#Confirm").attr("value",data);
                                        $("#check_number").css("display","block");
                                        $('button').prop('disabled', false);
                                    },
                                });
                            }
                        }
                    });
                }

                function confirmNumber(){
                    var number1 = $("#number").val();
                    var number2 = $("#Confirm").val();

                    if(number1 == number2){
                        alert("인증되었습니다.");
                        checked = true;
                    }else{
                        alert("번호가 다릅니다.");
                        checked = false;
                    }
                }

                function checkConfirm(){
                    if(checked != true){
                        alert("인증을 완료해주세요");
                        return false;  // form의 submit 이벤트를 취소
                    }
                    else{
                        return true;  // form의 submit 이벤트 진행
                    }
                }
            </script>

        <div class="input">
            <div class="label"><label>비밀번호</label></div>
            <input type="password" name="memberPassword1" class="campus_name search" maxlength="20" placeholder="패스워드를 입력하세요" autocomplete="off">
            <input type="hidden" name="camppus_id">
<!--            <p>8자 이상 50자 이내로 입력하세요. </p>-->
        </div>
        <div class="input">
            <div class="label"><label>비밀번호 확인</label></div>
            <input type="password" name="memberPassword2" class="campus_name search" maxlength="20" placeholder="패스워드 중복확인" autocomplete="off">
            <input type="hidden" name="camppus_id">

        </div>



        <ol class="campuses"></ol>

        <input type="submit" value="가입하기" id="btn" onclick="checkConfirm()">
    </div>
</form>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>
</html>
